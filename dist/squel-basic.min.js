/*! squel | https://github.com/hiddentao/squel | BSD license */!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.squel=e()}(this,function(){function t(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){return t.length?t+e:t}function n(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];if(t&&r)for(var n=function(e){"object"==typeof e&&Object.getOwnPropertyNames(e).forEach(function(r){t[r]=e[r]})},o=r,a=Array.isArray(o),l=0,o=a?o:o["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var u;if(a){if(l>=o.length)break;u=o[l++]}else{if(l=o.next(),l.done)break;u=l.value}var s=u;n(s)}return t}function o(t){return t&&t.constructor.prototype===Object.prototype}function a(t){return t&&t.constructor.prototype===Array.prototype}function l(t){if(!t)return t;if("function"==typeof t.clone)return t.clone();if(o(t)||a(t)){var e=new t.constructor;return Object.getOwnPropertyNames(t).forEach(function(r){"function"!=typeof t[r]&&(e[r]=l(t[r]))}),e}return JSON.parse(JSON.stringify(t))}function u(t,e,r){var i=typeof e;if("function"!==i&&"string"!==i)throw new Error("type must be a class constructor or string");if("function"!=typeof r)throw new Error("handler must be a function");for(var n=t,o=Array.isArray(n),a=0,n=o?n:n["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var l;if(o){if(a>=n.length)break;l=n[a++]}else{if(a=n.next(),a.done)break;l=a.value}var u=l;if(u.type===e)return void(u.handler=r)}t.push({type:e,handler:r})}function s(t,e,r){return f(t,e)||f(t,r)}function f(t,e){for(var r=0;r<e.length;r++){var i=e[r];if(typeof t===i.type||"string"!=typeof i.type&&t instanceof i.type)return i.handler}}function c(){var f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c={isSquelBuilder:function(t){return t&&!!t._toParamString}},d=function(t){return!c.isSquelBuilder(t)||!t.options.rawNesting};c.DefaultQueryBuilderOptions={autoQuoteTableNames:!1,autoQuoteFieldNames:!1,autoQuoteAliasNames:!0,useAsForTableAliasNames:!1,nameQuoteCharacter:"`",tableAliasQuoteCharacter:"`",fieldAliasQuoteCharacter:'"',valueHandlers:[],parameterCharacter:"?",numberedParameters:!1,numberedParametersPrefix:"$",numberedParametersStartAt:1,replaceSingleQuotes:!1,singleQuoteReplacement:"''",separator:" ",stringFormatter:null,rawNesting:!1},c.globalValueHandlers=[],c.registerValueHandler=function(t,e){u(c.globalValueHandlers,t,e)},c.Cloneable=function(){function t(){r(this,t)}return v(t,[{key:"clone",value:function(){var t=new this.constructor;return n(t,l(n({},this)))}}]),t}(),c.BaseBuilder=function(i){function o(e){r(this,o);var i=t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this)),a=JSON.parse(JSON.stringify(c.DefaultQueryBuilderOptions));return["stringFormatter"].forEach(function(t){a[t]=c.DefaultQueryBuilderOptions[t]}),i.options=n({},a,e),i}return e(o,i),v(o,[{key:"registerValueHandler",value:function(t,e){return u(this.options.valueHandlers,t,e),this}},{key:"_sanitizeExpression",value:function(t){if(!c.isSquelBuilder(t)&&"string"!=typeof t)throw new Error("expression must be a stringÂ or builder instance");return t}},{key:"_sanitizeName",value:function(t,e){if("string"!=typeof t)throw new Error(e+" must be a string");return t}},{key:"_sanitizeField",value:function(t){return c.isSquelBuilder(t)||(t=this._sanitizeName(t,"field name")),t}},{key:"_sanitizeBaseBuilder",value:function(t){if(c.isSquelBuilder(t))return t;throw new Error("must be a builder instance")}},{key:"_sanitizeTable",value:function(t){if("string"!=typeof t)try{t=this._sanitizeBaseBuilder(t)}catch(e){throw new Error("table name must be a string or a builder")}else t=this._sanitizeName(t,"table");return t}},{key:"_sanitizeTableAlias",value:function(t){return this._sanitizeName(t,"table alias")}},{key:"_sanitizeFieldAlias",value:function(t){return this._sanitizeName(t,"field alias")}},{key:"_sanitizeLimitOffset",value:function(t){if(t=parseInt(t),0>t||isNaN(t))throw new Error("limit/offset must be >= 0");return t}},{key:"_sanitizeValue",value:function(t){var e=typeof t;if(null===t);else if("string"===e||"number"===e||"boolean"===e);else if(c.isSquelBuilder(t));else{var r=!!s(t,this.options.valueHandlers,c.globalValueHandlers);if(!r)throw new Error("field value must be a string, number, boolean, null or one of the registered custom value types")}return t}},{key:"_escapeValue",value:function(t){return this.options.replaceSingleQuotes?t.replace(/\'/g,this.options.singleQuoteReplacement):t}},{key:"_formatTableName",value:function(t){if(this.options.autoQuoteTableNames){var e=this.options.nameQuoteCharacter;t=""+e+t+e}return t}},{key:"_formatFieldAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.fieldAliasQuoteCharacter;t=""+e+t+e}return t}},{key:"_formatTableAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.tableAliasQuoteCharacter;t=""+e+t+e}return this.options.useAsForTableAliasNames?"AS "+t:t}},{key:"_formatFieldName",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.options.autoQuoteFieldNames){var r=this.options.nameQuoteCharacter;t=e.ignorePeriodsForFieldNameQuotes?""+r+t+r:t.split(".").map(function(t){return"*"===t?t:""+r+t+r}).join(".")}return t}},{key:"_formatCustomValue",value:function(t,e,r){var i=s(t,this.options.valueHandlers,c.globalValueHandlers);return i&&(t=i(t,e,r),t&&t.rawNesting)?{formatted:!0,rawNesting:!0,value:t.value}:{formatted:!!i,value:t}}},{key:"_formatValueForParamArray",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(t)?t.map(function(t){return e._formatValueForParamArray(t,r)}):this._formatCustomValue(t,!0,r).value}},{key:"_formatValueForQueryString",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this._formatCustomValue(t,!1,r),n=i.rawNesting,o=i.formatted,l=i.value;if(o)return n?l:this._applyNestingFormatting(l,d(t));if(a(l))l=l.map(function(t){return e._formatValueForQueryString(t)}),l=this._applyNestingFormatting(l.join(", "),d(l));else{var u=typeof l;if(null===l)l="NULL";else if("boolean"===u)l=l?"TRUE":"FALSE";else if(c.isSquelBuilder(l))l=this._applyNestingFormatting(l.toString(),d(l));else if("number"!==u){if("string"===u&&this.options.stringFormatter)return this.options.stringFormatter(l);if(r.dontQuote)l=""+l;else{var s=this._escapeValue(l);l="'"+s+"'"}}}return l}},{key:"_applyNestingFormatting",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t&&"string"==typeof t&&e&&!this.options.rawNesting){var r="("===t.charAt(0)&&")"===t.charAt(t.length-1);if(r)for(var i=0,n=1;t.length-1>++i;){var o=t.charAt(i);if("("===o)n++;else if(")"===o&&(n--,1>n)){r=!1;break}}r||(t="("+t+")")}return t}},{key:"_buildString",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.nested,n=r.buildParameterized,o=r.formattingOptions;e=e||[],t=t||"";for(var l="",u=-1,s=[],f=this.options.parameterCharacter,h=0;t.length>h;)if(t.substr(h,f.length)===f){var v=e[++u];if(n)if(c.isSquelBuilder(v)){var d=v._toParamString({buildParameterized:n,nested:!0});l+=d.text,d.values.forEach(function(t){return s.push(t)})}else if(v=this._formatValueForParamArray(v,o),a(v)){var _=v.map(function(){return f}).join(", ");l+="("+_+")",v.forEach(function(t){return s.push(t)})}else l+=f,s.push(v);else l+=this._formatValueForQueryString(v,o);h+=f.length}else l+=t.charAt(h),h++;return{text:this._applyNestingFormatting(l,!!i),values:s}}},{key:"_buildManyStrings",value:function(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=[],n=[],o=0;t.length>o;++o){var a=t[o],l=e[o],u=this._buildString(a,l,{buildParameterized:r.buildParameterized,nested:!1}),s=u.text,f=u.values;i.push(s),f.forEach(function(t){return n.push(t)})}return i=i.join(this.options.separator),{text:i.length?this._applyNestingFormatting(i,!!r.nested):"",values:n}}},{key:"_toParamString",value:function(t){throw new Error("Not yet implemented")}},{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._toParamString(t).text}},{key:"toParam",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._toParamString(n({},t,{buildParameterized:!0}))}}]),o}(c.Cloneable),c.Expression=function(i){function n(e){r(this,n);var i=t(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i._nodes=[],i}return e(n,i),v(n,[{key:"and",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return t=this._sanitizeExpression(t),this._nodes.push({type:"AND",expr:t,para:r}),this}},{key:"or",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return t=this._sanitizeExpression(t),this._nodes.push({type:"OR",expr:t,para:r}),this}},{key:"_toParamString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[],r=[],i=this._nodes,n=Array.isArray(i),o=0,i=n?i:i["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var a;if(n){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var l=a,u=l.type,s=l.expr,f=l.para,h=c.isSquelBuilder(s)?s._toParamString({buildParameterized:t.buildParameterized,nested:!0}):this._buildString(s,f,{buildParameterized:t.buildParameterized}),v=h.text,d=h.values;e.length&&e.push(u),e.push(v),d.forEach(function(t){return r.push(t)})}return e=e.join(" "),{text:this._applyNestingFormatting(e,!!t.nested),values:r}}}]),n}(c.BaseBuilder),c.Case=function(a){function l(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,l);var a=t(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,i));return o(e)&&(i=e,e=null),e&&(a._fieldName=a._sanitizeField(e)),a.options=n({},c.DefaultQueryBuilderOptions,i),a._cases=[],a._elseValue=null,a}return e(l,a),v(l,[{key:"when",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return this._cases.unshift({expression:t,values:r||[]}),this}},{key:"then",value:function(t){if(0==this._cases.length)throw new Error("when() needs to be called first");return this._cases[0].result=t,this}},{key:"else",value:function(t){return this._elseValue=t,this}},{key:"_toParamString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="",r=[],n=this._cases,o=Array.isArray(n),a=0,n=o?n:n["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var l;if(o){if(a>=n.length)break;l=n[a++]}else{if(a=n.next(),a.done)break;l=a.value}var u=l,s=u.expression,f=u.values,c=u.result;e=i(e," ");var h=this._buildString(s,f,{buildParameterized:t.buildParameterized,nested:!0});e+="WHEN "+h.text+" THEN "+this._formatValueForQueryString(c),h.values.forEach(function(t){return r.push(t)})}return e.length?(e+=" ELSE "+this._formatValueForQueryString(this._elseValue)+" END",this._fieldName&&(e=this._fieldName+" "+e),e="CASE "+e):e=this._formatValueForQueryString(this._elseValue),{text:e,values:r}}}]),l}(c.BaseBuilder),c.Block=function(i){function n(e){return r(this,n),t(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e))}return e(n,i),v(n,[{key:"exposedMethods",value:function(){for(var t={},e=this;e;)Object.getOwnPropertyNames(e).forEach(function(r){"constructor"===r||"function"!=typeof e[r]||"_"===r.charAt(0)||c.Block.prototype[r]||(t[r]=e[r])}),e=Object.getPrototypeOf(e);return t}}]),n}(c.BaseBuilder),c.StringBlock=function(i){function n(e,i){r(this,n);var o=t(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return o._str=i,o}return e(n,i),v(n,[{key:"_toParamString",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{text:this._str,values:[]}}}]),n}(c.Block),c.FunctionBlock=function(i){function n(e){r(this,n);var i=t(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i._strings=[],i._values=[],i}return e(n,i),v(n,[{key:"function",value:function(t){this._strings.push(t);for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];this._values.push(r)}},{key:"_toParamString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._buildManyStrings(this._strings,this._values,t)}}]),n}(c.Block),c.registerValueHandler(c.FunctionBlock,function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?t.toParam():t.toString()}),c.AbstractTableBlock=function(n){function o(e,i){r(this,o);var n=t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return n._tables=[],n}return e(o,n),v(o,[{key:"_table",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=e?this._sanitizeTableAlias(e):e,t=this._sanitizeTable(t),this.options.singleTable&&(this._tables=[]),this._tables.push({table:t,alias:e})}},{key:"_hasTable",value:function(){return 0<this._tables.length}},{key:"_toParamString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="",r=[];if(this._hasTable()){for(var n=this._tables,o=Array.isArray(n),a=0,n=o?n:n["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var l;if(o){if(a>=n.length)break;l=n[a++]}else{if(a=n.next(),a.done)break;l=a.value}var u=l,s=u.table,f=u.alias;e=i(e,", ");var h=void 0;if(c.isSquelBuilder(s)){var v=s._toParamString({buildParameterized:t.buildParameterized,nested:!0}),d=v.text,_=v.values;h=d,_.forEach(function(t){return r.push(t)})}else h=this._formatTableName(s);f&&(h+=" "+this._formatTableAlias(f)),e+=h}this.options.prefix&&(e=this.options.prefix+" "+e)}return{text:e,values:r}}}]),o}(c.Block),c.TargetTableBlock=function(i){function n(){return r(this,n),t(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,i),v(n,[{key:"target",value:function(t){this._table(t)}}]),n}(c.AbstractTableBlock),c.UpdateTableBlock=function(i){function n(){return r(this,n),t(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,i),v(n,[{key:"table",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._table(t,e)}},{key:"_toParamString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._hasTable())throw new Error("table() needs to be called");return h(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_toParamString",this).call(this,t)}}]),n}(c.AbstractTableBlock),c.FromTableBlock=function(i){function o(e){return r(this,o),t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,n({},e,{prefix:"FROM"})))}return e(o,i),v(o,[{key:"from",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._table(t,e)}}]),o}(c.AbstractTableBlock),c.IntoTableBlock=function(i){function o(e){return r(this,o),t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,n({},e,{prefix:"INTO",singleTable:!0})))}return e(o,i),v(o,[{key:"into",value:function(t){this._table(t)}},{key:"_toParamString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._hasTable())throw new Error("into() needs to be called");return h(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"_toParamString",this).call(this,t)}}]),o}(c.AbstractTableBlock),c.GetFieldBlock=function(n){function o(e){r(this,o);var i=t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return i._fields=[],i}return e(o,n),v(o,[{key:"fields",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a(t))for(var r=t,i=Array.isArray(r),n=0,r=i?r:r["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var o;if(i){if(n>=r.length)break;o=r[n++]}else{if(n=r.next(),n.done)break;o=n.value}var l=o;this.field(l,null,e)}else for(var u in t){var s=t[u];this.field(u,s,e)}}},{key:"field",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e=e?this._sanitizeFieldAlias(e):e,t=this._sanitizeField(t);var i=this._fields.filter(function(r){return r.name===t&&r.alias===e});return i.length?this:void this._fields.push({name:t,alias:e,options:r})}},{key:"_toParamString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.queryBuilder,r=t.buildParameterized,n="",o=[],a=this._fields,l=Array.isArray(a),u=0,a=l?a:a["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var s;if(l){if(u>=a.length)break;s=a[u++]}else{if(u=a.next(),u.done)break;s=u.value}var f=s;n=i(n,", ");var h=f.name,v=f.alias,d=f.options;if("string"==typeof h)n+=this._formatFieldName(h,d);else{var _=h._toParamString({nested:!0,buildParameterized:r});n+=_.text,_.values.forEach(function(t){return o.push(t)})}v&&(n+=" AS "+this._formatFieldAlias(v))}if(!n.length){var p=e&&e.getBlock(c.FromTableBlock);p&&p._hasTable()&&(n="*")}return{text:n,values:o}}}]),o}(c.Block),c.AbstractSetFieldBlock=function(i){function n(e){r(this,n);var i=t(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i._reset(),i}return e(n,i),v(n,[{key:"_reset",value:function(){this._fields=[],this._values=[[]],this._valueOptions=[[]]}},{key:"_set",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._values.length>1)throw new Error("Cannot set multiple rows of fields this way.");"undefined"!=typeof e&&(e=this._sanitizeValue(e)),t=this._sanitizeField(t);var i=this._fields.indexOf(t);-1===i&&(this._fields.push(t),i=this._fields.length-1),this._values[0][i]=e,this._valueOptions[0][i]=r}},{key:"_setFields",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!=typeof t)throw new Error("Expected an object but got "+typeof t);for(var r in t)this._set(r,t[r],e)}},{key:"_setFieldsRows",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!a(t))throw new Error("Expected an array of objects but got "+typeof t);this._reset();for(var r=0;t.length>r;++r){var i=t[r];for(var n in i){var o=i[n];n=this._sanitizeField(n),o=this._sanitizeValue(o);var l=this._fields.indexOf(n);if(0<r&&-1===l)throw new Error("All fields in subsequent rows must match the fields in the first row");-1===l&&(this._fields.push(n),l=this._fields.length-1),a(this._values[r])||(this._values[r]=[],this._valueOptions[r]=[]),this._values[r][l]=o,this._valueOptions[r][l]=e}}}}]),n}(c.Block),c.SetFieldBlock=function(n){function o(){return r(this,o),t(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return e(o,n),v(o,[{key:"set",value:function(t,e,r){this._set(t,e,r)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"_toParamString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.buildParameterized;if(0>=this._fields.length)throw new Error("set() needs to be called");for(var r="",n=[],o=0;o<this._fields.length;++o){r=i(r,", ");var a=this._formatFieldName(this._fields[o]),l=this._values[0][o];0>a.indexOf("=")&&(a=a+" = "+this.options.parameterCharacter);var u=this._buildString(a,[l],{buildParameterized:e,formattingOptions:this._valueOptions[0][o]});r+=u.text,u.values.forEach(function(t){return n.push(t)})}return{text:"SET "+r,values:n}}}]),o}(c.AbstractSetFieldBlock),c.InsertFieldValueBlock=function(n){function o(){return r(this,o),t(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return e(o,n),v(o,[{key:"set",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._set(t,e,r)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"setFieldsRows",value:function(t,e){this._setFieldsRows(t,e)}},{key:"_toParamString",value:function(){for(var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.buildParameterized,n=this._fields.map(function(e){return t._formatFieldName(e)}).join(", "),o=[],a=[],l=0;l<this._values.length;++l){o[l]="";for(var u=0;u<this._values[l].length;++u){var s=this._buildString(this.options.parameterCharacter,[this._values[l][u]],{buildParameterized:r,formattingOptions:this._valueOptions[l][u]});s.values.forEach(function(t){return a.push(t)}),o[l]=i(o[l],", "),o[l]+=s.text}}return{text:n.length?"("+n+") VALUES ("+o.join("), (")+")":"",values:a}}}]),o}(c.AbstractSetFieldBlock),c.InsertFieldsFromQueryBlock=function(i){function n(e){r(this,n);var i=t(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i._fields=[],i._query=null,i}return e(n,i),v(n,[{key:"fromQuery",value:function(t,e){var r=this;this._fields=t.map(function(t){return r._sanitizeField(t)}),this._query=this._sanitizeBaseBuilder(e)}},{key:"_toParamString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="",r=[];if(this._fields.length&&this._query){var i=this._query._toParamString({buildParameterized:t.buildParameterized,nested:!0}),n=i.text,o=i.values;e="("+this._fields.join(", ")+") "+this._applyNestingFormatting(n),r=o}return{text:e,values:r}}}]),n}(c.Block),c.DistinctBlock=function(i){function n(){return r(this,n),t(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return e(n,i),v(n,[{key:"distinct",value:function(){this._useDistinct=!0}},{key:"_toParamString",value:function(){return{text:this._useDistinct?"DISTINCT":"",values:[]}}}]),n}(c.Block),c.GroupByBlock=function(i){function n(e){r(this,n);var i=t(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i._groups=[],i}return e(n,i),v(n,[{key:"group",value:function(t){this._groups.push(this._sanitizeField(t))}},{key:"_toParamString",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{text:this._groups.length?"GROUP BY "+this._groups.join(", "):"",values:[]}}}]),n}(c.Block),c.AbstractVerbSingleValueBlock=function(i){function n(e){r(this,n);var i=t(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i._value=null,i}return e(n,i),v(n,[{key:"_setValue",value:function(t){this._value=this._sanitizeLimitOffset(t)}},{key:"_toParamString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=null!==this._value?this.options.verb+" "+this.options.parameterCharacter:"",r=null!==this._value?[this._value]:[];return this._buildString(e,r,t)}}]),n}(c.Block),c.OffsetBlock=function(i){function o(e){return r(this,o),t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,n({},e,{verb:"OFFSET"})))}return e(o,i),v(o,[{key:"offset",value:function(t){this._setValue(t)}}]),o}(c.AbstractVerbSingleValueBlock),c.LimitBlock=function(i){function o(e){return r(this,o),t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,n({},e,{verb:"LIMIT"})))}return e(o,i),v(o,[{key:"limit",value:function(t){this._setValue(t)}}]),o}(c.AbstractVerbSingleValueBlock),c.AbstractConditionBlock=function(i){function n(e){r(this,n);var i=t(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i._conditions=[],i}return e(n,i),v(n,[{key:"_condition",value:function(t){t=this._sanitizeExpression(t);for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];this._conditions.push({expr:t,values:r||[]})}},{key:"_toParamString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[],r=[],i=this._conditions,n=Array.isArray(i),o=0,i=n?i:i["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var a;if(n){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var l=a,u=l.expr,s=l.values,f=c.isSquelBuilder(u)?u._toParamString({buildParameterized:t.buildParameterized}):this._buildString(u,s,{buildParameterized:t.buildParameterized});f.text.length&&e.push(f.text),f.values.forEach(function(t){return r.push(t)})}return e.length&&(e=e.join(") AND (")),{text:e.length?this.options.verb+" ("+e+")":"",values:r}}}]),n}(c.Block),c.WhereBlock=function(i){function o(e){return r(this,o),t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,n({},e,{verb:"WHERE"})))}return e(o,i),v(o,[{key:"where",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];this._condition.apply(this,[t].concat(r))}}]),o}(c.AbstractConditionBlock),c.HavingBlock=function(i){function o(e){return r(this,o),t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,n({},e,{verb:"HAVING"})))}return e(o,i),v(o,[{key:"having",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];this._condition.apply(this,[t].concat(r))}}]),o}(c.AbstractConditionBlock),c.OrderByBlock=function(n){function o(e){r(this,o);var i=t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return i._orders=[],i}return e(o,n),v(o,[{key:"order",value:function(t,e){t=this._sanitizeField(t),"string"!=typeof e&&(void 0===e?e="ASC":null!==e&&(e=e?"ASC":"DESC"));for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];this._orders.push({field:t,dir:e,values:i||[]})}},{key:"_toParamString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="",r=[],n=this._orders,o=Array.isArray(n),l=0,n=o?n:n["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var u;if(o){if(l>=n.length)break;u=n[l++]}else{if(l=n.next(),l.done)break;u=l.value}var s=u,f=s.field,c=s.dir,h=s.values;e=i(e,", ");var v=this._buildString(f,h,{buildParameterized:t.buildParameterized});e+=v.text,a(v.values)&&v.values.forEach(function(t){return r.push(t)}),null!==c&&(e+=" "+c)}return{text:e.length?"ORDER BY "+e:"",values:r}}}]),o}(c.Block),c.JoinBlock=function(n){function o(e){r(this,o);var i=t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return i._joins=[],i}return e(o,n),v(o,[{key:"join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"INNER";t=this._sanitizeTable(t,!0),e=e?this._sanitizeTableAlias(e):e,r=r?this._sanitizeExpression(r):r,this._joins.push({type:i,table:t,alias:e,condition:r})}},{key:"left_join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,r,"LEFT")}},{key:"right_join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,r,"RIGHT")}},{key:"outer_join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,r,"OUTER")}},{key:"left_outer_join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,r,"LEFT OUTER")}},{key:"full_join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,r,"FULL")}},{key:"cross_join",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,r,"CROSS")}},{key:"_toParamString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="",r=[],n=this._joins,o=Array.isArray(n),a=0,n=o?n:n["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var l;if(o){if(a>=n.length)break;l=n[a++]}else{if(a=n.next(),a.done)break;l=a.value}var u=l,s=u.type,f=u.table,h=u.alias,v=u.condition;e=i(e,this.options.separator);var d=void 0;if(c.isSquelBuilder(f)){var _=f._toParamString({buildParameterized:t.buildParameterized,nested:!0});_.values.forEach(function(t){return r.push(t)}),d=_.text}else d=this._formatTableName(f);if(e+=s+" JOIN "+d,h&&(e+=" "+this._formatTableAlias(h)),v){e+=" ON ";var p=void 0;p=c.isSquelBuilder(v)?v._toParamString({buildParameterized:t.buildParameterized}):this._buildString(v,[],{buildParameterized:t.buildParameterized}),e+=this._applyNestingFormatting(p.text),p.values.forEach(function(t){return r.push(t)})}}return{text:e,values:r}}}]),o}(c.Block),c.UnionBlock=function(n){function o(e){r(this,o);var i=t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return i._unions=[],i}return e(o,n),v(o,[{key:"union",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UNION";t=this._sanitizeTable(t),this._unions.push({type:e,table:t})}},{key:"union_all",value:function(t){this.union(t,"UNION ALL")}},{key:"_toParamString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="",r=[],n=this._unions,o=Array.isArray(n),a=0,n=o?n:n["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var l;if(o){if(a>=n.length)break;l=n[a++]}else{if(a=n.next(),a.done)break;l=a.value}var u=l,s=u.type,f=u.table;e=i(e,this.options.separator);var h=void 0;if(f instanceof c.BaseBuilder){var v=f._toParamString({buildParameterized:t.buildParameterized,nested:!0});h=v.text,v.values.forEach(function(t){return r.push(t)})}else e=this._formatTableName(f);e+=s+" "+h}return{text:e,values:r}}}]),o}(c.Block),c.QueryBuilder=function(i){function o(e,i){r(this,o);var n=t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));n.blocks=i||[];for(var a=n.blocks,l=Array.isArray(a),u=0,a=l?a:a["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var s;if(l){if(u>=a.length)break;s=a[u++]}else{if(u=a.next(),u.done)break;s=u.value}var f=s,c=f.exposedMethods();for(var h in c){var v=c[h];if(void 0!==n[h])throw new Error("Builder already has a builder method called: "+h);!function(t,e,r){n[e]=function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return r.call.apply(r,[t].concat(i)),n}}(f,h,v)}}return n}return e(o,i),v(o,[{key:"registerValueHandler",value:function(t,e){for(var r=this.blocks,i=Array.isArray(r),n=0,r=i?r:r["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var a;if(i){if(n>=r.length)break;a=r[n++]}else{if(n=r.next(),n.done)break;a=n.value}var l=a;l.registerValueHandler(t,e)}return h(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"registerValueHandler",this).call(this,t,e),this}},{key:"updateOptions",value:function(t){this.options=n({},this.options,t);for(var e=this.blocks,r=Array.isArray(e),i=0,e=r?e:e["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var o;if(r){if(i>=e.length)break;o=e[i++]}else{if(i=e.next(),i.done)break;o=i.value}var a=o;a.options=n({},a.options,t)}}},{key:"_toParamString",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=n({},this.options,e);var r=this.blocks.map(function(r){return r._toParamString({buildParameterized:e.buildParameterized,queryBuilder:t})}),i=r.map(function(t){return t.text}),o=r.map(function(t){return t.values}),a=i.filter(function(t){return 0<t.length}).join(e.separator),l=[];if(o.forEach(function(t){return t.forEach(function(t){return l.push(t)})}),!e.nested&&e.numberedParameters){var u=void 0!==e.numberedParametersStartAt?e.numberedParametersStartAt:1,s=e.parameterCharacter.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");a=a.replace(new RegExp(s,"g"),function(){return""+e.numberedParametersPrefix+u++})}return{text:this._applyNestingFormatting(a,!!e.nested),values:l}}},{key:"clone",value:function(){var t=this.blocks.map(function(t){return t.clone()});return new this.constructor(this.options,t)}},{key:"getBlock",value:function(t){var e=this.blocks.filter(function(e){return e instanceof t});return e[0]}}]),o}(c.BaseBuilder),c.Select=function(i){
function n(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r(this,n),i=i||[new c.StringBlock(e,"SELECT"),new c.FunctionBlock(e),new c.DistinctBlock(e),new c.GetFieldBlock(e),new c.FromTableBlock(e),new c.JoinBlock(e),new c.WhereBlock(e),new c.GroupByBlock(e),new c.HavingBlock(e),new c.OrderByBlock(e),new c.LimitBlock(e),new c.OffsetBlock(e),new c.UnionBlock(e)],t(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,i))}return e(n,i),n}(c.QueryBuilder),c.Update=function(i){function n(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r(this,n),i=i||[new c.StringBlock(e,"UPDATE"),new c.UpdateTableBlock(e),new c.SetFieldBlock(e),new c.WhereBlock(e),new c.OrderByBlock(e),new c.LimitBlock(e)],t(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,i))}return e(n,i),n}(c.QueryBuilder),c.Delete=function(i){function o(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r(this,o),i=i||[new c.StringBlock(e,"DELETE"),new c.TargetTableBlock(e),new c.FromTableBlock(n({},e,{singleTable:!0})),new c.JoinBlock(e),new c.WhereBlock(e),new c.OrderByBlock(e),new c.LimitBlock(e)],t(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e,i))}return e(o,i),o}(c.QueryBuilder),c.Insert=function(i){function n(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r(this,n),i=i||[new c.StringBlock(e,"INSERT"),new c.IntoTableBlock(e),new c.InsertFieldValueBlock(e),new c.InsertFieldsFromQueryBlock(e)],t(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,i))}return e(n,i),n}(c.QueryBuilder);var _={VERSION:"5.11.1",flavour:f,expr:function(t){return new c.Expression(t)},"case":function(t,e){return new c.Case(t,e)},select:function(t,e){return new c.Select(t,e)},update:function(t,e){return new c.Update(t,e)},insert:function(t,e){return new c.Insert(t,e)},"delete":function(t,e){return new c.Delete(t,e)},str:function(){var t=new c.FunctionBlock;return t["function"].apply(t,arguments),t},rstr:function(){var t=new c.FunctionBlock({rawNesting:!0});return t["function"].apply(t,arguments),t},registerValueHandler:c.registerValueHandler};return _.remove=_["delete"],_.cls=c,_}var h=function _(t,e,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var n=Object.getPrototypeOf(t);return null===n?void 0:_(n,e,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},v=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),d=c();return d.flavours={},d.useFlavour=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!t)return d;if(d.flavours[t]instanceof Function){var e=c(t);return d.flavours[t].call(null,e),e.flavours=d.flavours,e.useFlavour=d.useFlavour,e}throw new Error("Flavour not available: "+t)},d});